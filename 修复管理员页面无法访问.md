# 🔧 修复管理员页面无法访问问题

## 问题描述

点击"用户管理"、"兑换码管理"、"积分管理"时，页面会闪一下然后什么都没有。

## 问题原因

`isAdmin` 函数在客户端组件中使用 `process.env.ADMIN_USERS`，但 Next.js 的环境变量在客户端是不可访问的（除非有 `NEXT_PUBLIC_` 前缀）。

## 解决方案

在 `.env.local` 文件中添加 `NEXT_PUBLIC_ADMIN_USERS` 环境变量，**只包含用户名部分（不包含密码）**。

### 配置步骤

1. **打开 `.env.local` 文件**

2. **添加 `NEXT_PUBLIC_ADMIN_USERS` 环境变量**

   格式：只包含用户名，多个用户用逗号分隔

   ```env
   # 如果 ADMIN_USERS=admin:admin123,test@factory-buy.com:password123
   # 那么 NEXT_PUBLIC_ADMIN_USERS 应该是：
   NEXT_PUBLIC_ADMIN_USERS=admin,test@factory-buy.com
   ```

   **重要：**
   - ✅ 只包含用户名（email），不包含密码
   - ✅ 多个用户用逗号分隔
   - ✅ 如果用户名包含 `@`，保持完整格式（如 `test@factory-buy.com`）
   - ✅ 如果用户名不包含 `@`，会自动匹配 `username@admin.local` 格式

3. **完整示例**

   ```env
   # 服务端使用的完整配置（包含密码）
   ADMIN_USERS=admin:admin123,test@factory-buy.com:password123
   
   # 客户端使用的配置（只包含用户名，不包含密码）
   NEXT_PUBLIC_ADMIN_USERS=admin,test@factory-buy.com
   ```

4. **重启开发服务器**

   ```bash
   # 停止当前服务器（Ctrl + C）
   # 然后重新启动
   npm run dev
   ```

## 验证修复

1. 登录管理员账号
2. 点击"用户管理"、"兑换码管理"、"积分管理"
3. 应该能正常进入页面，不再闪退

## 安全说明

- `NEXT_PUBLIC_ADMIN_USERS` 只包含用户名，不包含密码，相对安全
- 但用户名信息会暴露在客户端代码中
- 这是 Next.js 客户端组件的限制，无法完全避免
- 真正的权限验证在后端进行，前端只是用于 UI 显示

## 相关文件

- `lib/auth/is-admin.ts` - 管理员检查函数
- `lib/auth/require-admin.tsx` - 管理员权限检查 Hook
- `app/admin/users/page.tsx` - 用户管理页面
- `app/admin/redeem-codes/page.tsx` - 兑换码管理页面
- `app/admin/credits/page.tsx` - 积分管理页面


