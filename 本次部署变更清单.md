# æœ¬æ¬¡éƒ¨ç½²å˜æ›´æ¸…å•

## ğŸ“‹ å˜æ›´æ¦‚è¿°

æœ¬æ¬¡ä¸»è¦å®Œæˆäº† **M4ï¼šæ”¹è¿›é”™è¯¯å¤„ç†å’Œå¯è§‚æµ‹æ€§**ï¼Œä»¥åŠæ·»åŠ äº†**æ¨¡å¼åˆ‡æ¢**å’Œ**å……å€¼åŠŸèƒ½**ã€‚

## ğŸ”„ å‰ç«¯å˜æ›´ï¼ˆéœ€è¦éƒ¨ç½²åˆ° Vercelï¼‰

### æ–°å¢æ–‡ä»¶
1. `lib/errors/error-codes.ts` - ç»Ÿä¸€é”™è¯¯ç å®šä¹‰
2. `lib/errors/error-handler.ts` - ç»Ÿä¸€é”™è¯¯å¤„ç†å·¥å…·
3. `components/errors/error-display.tsx` - é”™è¯¯æ˜¾ç¤ºç»„ä»¶
4. `app/api/mode/toggle/route.ts` - æ¨¡å¼åˆ‡æ¢æ¥å£
5. `app/api/credits/add/route.ts` - å……å€¼æ¥å£ï¼ˆå‰ç«¯ä»£ç†ï¼‰

### ä¿®æ”¹æ–‡ä»¶
1. `app/dream-factory/page.tsx` - é›†æˆé”™è¯¯æ˜¾ç¤ºã€æ¨¡å¼åˆ‡æ¢ã€å……å€¼æŒ‰é’®
2. `app/api/ai/generate-text/route.ts` - æ”¯æŒæ¨¡å¼å‚æ•°ä¼ é€’
3. `app/api/ai/generate-image/route.ts` - æ”¯æŒæ¨¡å¼å‚æ•°ä¼ é€’ã€æ”¹è¿›é”™è¯¯å¤„ç†
4. `app/api/ai/generate-job/route.ts` - æ”¯æŒæ¨¡å¼å‚æ•°ä¼ é€’
5. `lib/ai/dry-run-check.ts` - æ”¯æŒè¦†ç›–æ¨¡å¼å‚æ•°

### åŠŸèƒ½æ”¹è¿›
- âœ… ç»Ÿä¸€é”™è¯¯ç ç³»ç»Ÿï¼ˆ40+ é”™è¯¯ç ï¼‰
- âœ… ç»Ÿä¸€é”™è¯¯å¤„ç†ï¼ˆæ ‡å‡†åŒ–é”™è¯¯å¯¹è±¡ï¼‰
- âœ… æ”¹è¿›é”™è¯¯æ˜¾ç¤º UIï¼ˆä¸åŒé”™è¯¯ç±»å‹ä¸åŒæ ·å¼ï¼‰
- âœ… æ¨¡å¼åˆ‡æ¢åŠŸèƒ½ï¼ˆDRY_RUN â†” REALï¼‰
- âœ… å……å€¼åŠŸèƒ½ï¼ˆå¼€å‘ç¯å¢ƒï¼‰
- âœ… é”™è¯¯è¿½è¸ª IDï¼ˆä¾¿äºè°ƒè¯•ï¼‰

## ğŸ”„ åç«¯å˜æ›´ï¼ˆéœ€è¦éƒ¨ç½²åˆ° ECSï¼‰

### ä¿®æ”¹æ–‡ä»¶
1. `backend-api/src/credits/credits.controller.ts` - æ·»åŠ  `POST /credits/recharge` æ¥å£

### æ–°å¢åŠŸèƒ½
- âœ… å……å€¼æ¥å£ï¼ˆ`POST /credits/recharge`ï¼‰
  - ç”Ÿäº§ç¯å¢ƒé»˜è®¤ç¦ç”¨ï¼ˆéœ€è¦ `ALLOW_RECHARGE=true`ï¼‰
  - ä½¿ç”¨è´¦æœ¬æ¨¡å¼ï¼Œä¿æŒæ•°æ®ä¸€è‡´æ€§

## ğŸš€ éƒ¨ç½²æ­¥éª¤

### ä¸€ã€å‰ç«¯éƒ¨ç½²ï¼ˆVercelï¼‰

#### 1. æäº¤ä»£ç åˆ° Git

```bash
# æ£€æŸ¥å˜æ›´
git status

# æ·»åŠ æ‰€æœ‰å˜æ›´
git add .

# æäº¤
git commit -m "feat: M4 å®Œæˆ - æ”¹è¿›é”™è¯¯å¤„ç†å’Œå¯è§‚æµ‹æ€§ï¼Œæ·»åŠ æ¨¡å¼åˆ‡æ¢å’Œå……å€¼åŠŸèƒ½"

# æ¨é€åˆ°è¿œç¨‹ä»“åº“
git push
```

#### 2. Vercel è‡ªåŠ¨éƒ¨ç½²

- Vercel ä¼šè‡ªåŠ¨æ£€æµ‹åˆ°ä»£ç æ¨é€å¹¶å¼€å§‹éƒ¨ç½²
- æˆ–æ‰‹åŠ¨åœ¨ Vercel Dashboard è§¦å‘éƒ¨ç½²

#### 3. æ£€æŸ¥éƒ¨ç½²

- è®¿é—®éƒ¨ç½²åçš„ URL
- æµ‹è¯•é”™è¯¯æ˜¾ç¤ºåŠŸèƒ½
- æµ‹è¯•æ¨¡å¼åˆ‡æ¢åŠŸèƒ½
- æµ‹è¯•å……å€¼åŠŸèƒ½ï¼ˆå¼€å‘ç¯å¢ƒï¼‰

### äºŒã€åç«¯éƒ¨ç½²ï¼ˆECSï¼‰

#### 1. ä¸Šä¼ ä»£ç åˆ°æœåŠ¡å™¨

```bash
# åœ¨æœ¬åœ°æ„å»ºåç«¯ä»£ç 
cd backend-api
npm install
npm run build

# ä¸Šä¼ åˆ°æœåŠ¡å™¨ï¼ˆæ›¿æ¢ä¸ºå®é™…æœåŠ¡å™¨ä¿¡æ¯ï¼‰
scp -r dist/ root@your-server-ip:/opt/ue-assets-backend/backend-api/
scp package.json root@your-server-ip:/opt/ue-assets-backend/backend-api/
scp tsconfig.json root@your-server-ip:/opt/ue-assets-backend/backend-api/
scp ecosystem.config.js root@your-server-ip:/opt/ue-assets-backend/backend-api/
```

#### 2. åœ¨æœåŠ¡å™¨ä¸Šå®‰è£…ä¾èµ–å¹¶é‡å¯

```bash
# SSH åˆ°æœåŠ¡å™¨
ssh root@your-server-ip

# è¿›å…¥åç«¯ç›®å½•
cd /opt/ue-assets-backend/backend-api

# å®‰è£…ä¾èµ–
npm install --production

# é‡å¯æœåŠ¡
pm2 restart ue-assets-backend

# æŸ¥çœ‹æ—¥å¿—ç¡®è®¤
pm2 logs ue-assets-backend --lines 50
```

#### 3. éªŒè¯éƒ¨ç½²

```bash
# æµ‹è¯•å¥åº·æ£€æŸ¥
curl https://api.your-domain.com/health

# æµ‹è¯•å……å€¼æ¥å£ï¼ˆéœ€è¦å…ˆç™»å½•è·å– tokenï¼‰
curl -X POST https://api.your-domain.com/credits/recharge \
  -H "Authorization: Bearer <token>" \
  -H "Content-Type: application/json" \
  -d '{"amount": 100}'
```

## âš™ï¸ ç¯å¢ƒå˜é‡é…ç½®

### å‰ç«¯ï¼ˆVercelï¼‰

æ— éœ€æ–°å¢ç¯å¢ƒå˜é‡ï¼Œä½¿ç”¨ç°æœ‰é…ç½®å³å¯ã€‚

### åç«¯ï¼ˆECSï¼‰

å¦‚æœéœ€è¦å¯ç”¨å……å€¼åŠŸèƒ½ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰ï¼Œéœ€è¦æ·»åŠ ï¼š

```env
ALLOW_RECHARGE=true  # å…è®¸ä½¿ç”¨å……å€¼æ¥å£
```

**æ³¨æ„**ï¼šç”Ÿäº§ç¯å¢ƒå»ºè®®ç¦ç”¨å……å€¼æ¥å£ï¼Œæˆ–æ·»åŠ ç®¡ç†å‘˜æƒé™æ£€æŸ¥ã€‚

## âœ… éƒ¨ç½²åéªŒè¯æ¸…å•

### å‰ç«¯éªŒè¯
- [ ] é”™è¯¯æ˜¾ç¤ºæ­£å¸¸ï¼ˆä¸åŒé”™è¯¯ç±»å‹æ˜¾ç¤ºä¸åŒæ ·å¼ï¼‰
- [ ] æ¨¡å¼åˆ‡æ¢åŠŸèƒ½æ­£å¸¸ï¼ˆDRY_RUN â†” REALï¼‰
- [ ] å……å€¼æŒ‰é’®æ˜¾ç¤ºï¼ˆå¼€å‘ç¯å¢ƒï¼‰
- [ ] é”™è¯¯è¿½è¸ª ID æ˜¾ç¤ºï¼ˆå¼€å‘ç¯å¢ƒï¼‰
- [ ] ä½™é¢ä¸è¶³æ—¶æ˜¾ç¤ºå‹å¥½é”™è¯¯æç¤º

### åç«¯éªŒè¯
- [ ] å¥åº·æ£€æŸ¥æ¥å£æ­£å¸¸
- [ ] å……å€¼æ¥å£å¯ç”¨ï¼ˆå¦‚æœå¯ç”¨ï¼‰
- [ ] æ¨¡å¼åˆ‡æ¢ä¸å½±å“åç«¯é€»è¾‘
- [ ] é”™è¯¯å“åº”æ ¼å¼ç»Ÿä¸€

## ğŸ” å›æ»šæ–¹æ¡ˆ

å¦‚æœéƒ¨ç½²åå‡ºç°é—®é¢˜ï¼Œå¯ä»¥ï¼š

### å‰ç«¯å›æ»š
- åœ¨ Vercel Dashboard â†’ Deployments â†’ é€‰æ‹©ä¹‹å‰çš„éƒ¨ç½² â†’ Redeploy

### åç«¯å›æ»š
```bash
# æ¢å¤ä¹‹å‰çš„ä»£ç 
cd /opt/ue-assets-backend/backend-api
git checkout <previous-commit>
npm install --production
pm2 restart ue-assets-backend
```

## ğŸ“ æ³¨æ„äº‹é¡¹

1. **å……å€¼æ¥å£å®‰å…¨**ï¼šç”Ÿäº§ç¯å¢ƒå»ºè®®ç¦ç”¨æˆ–æ·»åŠ æƒé™æ£€æŸ¥
2. **é”™è¯¯è¿½è¸ª**ï¼šå¼€å‘ç¯å¢ƒæ˜¾ç¤ºè¿½è¸ª IDï¼Œç”Ÿäº§ç¯å¢ƒéšè—
3. **æ¨¡å¼åˆ‡æ¢**ï¼šå‰ç«¯çŠ¶æ€åˆ‡æ¢ï¼Œå®é™…æ¨¡å¼ç”±åç«¯æ§åˆ¶
4. **æ•°æ®åº“ä¸€è‡´æ€§**ï¼šå……å€¼ä½¿ç”¨è´¦æœ¬æ¨¡å¼ï¼Œç¡®ä¿æ•°æ®ä¸€è‡´æ€§

## ğŸ¯ ä¸‹ä¸€æ­¥

éƒ¨ç½²å®Œæˆåï¼Œå»ºè®®ï¼š
1. æµ‹è¯•æ‰€æœ‰åŠŸèƒ½
2. ç›‘æ§é”™è¯¯æ—¥å¿—
3. æ”¶é›†ç”¨æˆ·åé¦ˆ
4. æ ¹æ®åé¦ˆä¼˜åŒ–é”™è¯¯æç¤º

