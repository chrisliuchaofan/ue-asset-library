# 执行前检查清单

**生成时间**: 2024-12-19  
**基于**: 《分阶段清理计划 V2.1.md》

---

## ✅ 执行前必须完成的5项检查

### 1. Git 工作区状态检查

```bash
git status --short
```

**要求**: 输出必须为空（或只有预期的修改）

**如果不干净**:
- ✅ 使用 `git stash push -u -m "暂存清理前的状态"` 暂存
- ✅ 或使用 `git add -A && git commit -m "chore: 提交当前工作状态"` 提交
- ❌ **禁止**在 dirty 状态下切换分支（脏改动会跟随）

**验证**: 再次运行 `git status --short` 确认干净

---

### 2. 备份方案确认

**默认方案（推荐）**:
```bash
# 方案A：创建 tag（推荐）
git tag pre-cleanup-$(date +%Y%m%d)

# 方案B：使用 stash
git stash push -u -m "pre-cleanup"
```

**⚠️ 注意**: 
- 默认**不使用 commit**备份
- 只有在明确要求把当前状态入历史时，才使用 commit

**恢复方式**:
- Tag: `git checkout pre-cleanup-YYYYMMDD`
- Stash: `git stash pop` 或 `git stash apply stash@{0}`

---

### 3. 验证命令可用性检查

**确认以下 scripts 存在且可用**:
```bash
npm run build    # ✅ 必须存在
npm run lint     # ✅ 必须存在
npm run dev      # ✅ 必须存在
npm run start    # ✅ 必须存在
npm run test     # ⚠️ 实际是 build，不是真正的测试
```

**验证**:
```bash
npm run build --dry-run 2>&1 || npm run build 2>&1 | head -5
npm run lint --dry-run 2>&1 || npm run lint 2>&1 | head -5
```

---

### 4. 依赖审计工具准备

**安装 depcheck（如果未安装）**:
```bash
# 使用 npx（推荐，不污染全局）
npx depcheck --version

# 或全局安装（可选）
npm install -g depcheck
```

**验证**:
```bash
mkdir -p docs/cleanup
npx depcheck > docs/cleanup/test-depcheck.txt 2>&1
cat docs/cleanup/test-depcheck.txt | head -20
```

**⚠️ 重要**: 第二阶段依赖删除**必须**有 depcheck 证据，否则禁止删除

---

### 5. 构建产物检查

**确认以下文件/目录存在**:
```bash
ls -lh build.log tsconfig.tsbuildinfo 2>/dev/null || echo "文件不存在"
ls -ld backend-api/dist/ 2>/dev/null || echo "目录不存在"
git ls-files backend-api/dist/ | head -5
```

**确认 .gitignore 已配置**:
```bash
grep -E "(build\.log|tsbuildinfo|backend-api/dist)" .gitignore
```

**预期结果**:
- `build.log` 和 `tsconfig.tsbuildinfo` 存在但未被跟踪
- `backend-api/dist/` 存在且被跟踪
- `.gitignore` 中包含相关规则

---

## ✅ 检查完成后的确认

完成以上5项检查后，请确认：

- [ ] Git 工作区干净
- [ ] 备份方案已执行（tag 或 stash）
- [ ] 所有验证命令可用
- [ ] depcheck 工具可用
- [ ] 构建产物检查完成

**确认后回复**: "开始执行"

---

**检查清单生成时间**: 2024-12-19

