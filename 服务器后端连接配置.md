# 服务器后端连接配置

## 当前配置

后端服务在服务器上运行：
- **服务器 IP**: `8.148.196.57`
- **后端端口**: `3002`
- **后端 URL**: `http://8.148.196.57:3002`

## 配置步骤

### 1. 修改 `.env.local` 文件

打开 `.env.local` 文件，找到或添加：

```env
NEXT_PUBLIC_BACKEND_API_URL=http://8.148.196.57:3002
```

**注意：**
- 必须包含 `http://` 协议
- 使用服务器 IP 而不是 `localhost`
- 端口是 `3002`

### 2. 重启开发服务器

修改后，**必须重启开发服务器**才能生效：

```bash
# 停止当前服务器（Ctrl + C）
# 然后重新启动
npm run dev
```

### 3. 验证配置

重启后，在浏览器控制台应该能看到：

```
[BackendApiClient] 后端 API URL: http://8.148.196.57:3002
```

## 环境区分

### 本地开发（连接服务器后端）
```env
NEXT_PUBLIC_BACKEND_API_URL=http://8.148.196.57:3002
```

### 本地开发（连接本地后端）
```env
NEXT_PUBLIC_BACKEND_API_URL=http://localhost:3002
```

### 生产环境
```env
NEXT_PUBLIC_BACKEND_API_URL=https://api.factory-buy.com
```

## 常见问题

### Q: 修改后还是连接失败？

**检查清单：**
1. ✅ `.env.local` 文件已保存
2. ✅ 开发服务器已重启
3. ✅ 服务器后端服务正在运行（端口 3002）
4. ✅ 服务器防火墙允许 3002 端口访问
5. ✅ 网络可以访问服务器 IP

### Q: 如何测试服务器后端是否可访问？

在本地终端运行：

```bash
# 测试服务器后端是否可访问
curl http://8.148.196.57:3002/health

# 或者测试登录接口
curl -X POST http://8.148.196.57:3002/auth/login \
  -H "Content-Type: application/json" \
  -d '{"email":"test@factory-buy.com","password":"password123"}'
```

如果返回错误或超时，可能是：
- 服务器后端服务未运行
- 服务器防火墙阻止了端口 3002
- 网络无法访问服务器 IP

### Q: 服务器防火墙配置

如果无法连接，可能需要在服务器上开放端口 3002：

```bash
# 检查防火墙状态
sudo ufw status

# 开放端口 3002（如果使用 ufw）
sudo ufw allow 3002/tcp

# 或者检查 iptables
sudo iptables -L -n | grep 3002
```

## 注意事项

- `.env.local` 文件不会被提交到 Git（已在 `.gitignore` 中）
- 修改 `.env.local` 后必须重启开发服务器
- 生产环境部署时，需要在部署平台（如 Vercel）配置环境变量







