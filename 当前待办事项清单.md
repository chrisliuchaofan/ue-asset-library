# 当前待办事项清单

**更新时间：** 2025-12-19  
**状态：** 主要功能已完成，剩余为可选优化项

---

## ✅ 已完成的主要功能

### 里程碑完成情况

- ✅ **M1：** 前后端用户身份链路修复
- ✅ **M2：** AI 调用接入后端计费
- ✅ **M3：** 验证运行状态
- ✅ **M4：** 错误处理和可观测性
- ✅ **M5：** 用户管理 UI
- ✅ **M6：** Dry Run 模式 UI
- ✅ **登录逻辑修改：** 优先使用数据库验证

### 其他已完成功能

- ✅ 数据库迁移脚本
- ✅ M5.1 生成产物存储策略（OSS 上传）
- ✅ 管理员权限检查系统
- ✅ 后端部署工作流优化

---

## ⏳ 待完成的待办事项

### 1. M5.1: Cron 任务清理临时文件（可选）🔶

**优先级：** 低（可选优化）

**描述：**
- 添加定时任务，清理 `/tmp/dream-factory` 目录下超过 24 小时的临时文件
- 防止临时文件堆积占用磁盘空间

**实现方案：**
- 使用 `@nestjs/schedule` 模块
- 每天凌晨执行清理任务
- 清理 24 小时前的临时文件

**预计时间：** 0.5 天

**影响：** 不影响核心功能，仅为优化项

---

### 2. M5.1: 服务器端数据层迁移（Dream Factory 项目数据）🔶

**优先级：** 中（功能增强）

**描述：**
- 将 Dream Factory 项目数据从 localStorage 迁移到服务器端
- 实现跨设备同步功能

**实施步骤：**
1. 创建 Project 实体（数据库表）
2. 创建 Projects Service 和 Controller
3. 创建前端 API 路由
4. 修改 `lib/dream-factory/storage.ts`，支持后端存储
5. 实现数据迁移功能（从 localStorage 迁移到服务器）

**预计时间：** 3-4 天

**影响：** 功能增强，不影响现有功能

---

### 3. 代码中的 TODO 注释（可选优化）🔶

**优先级：** 低（后续优化）

#### 3.1 `app/api/ai/generate-job/route.ts:58`
```typescript
// TODO: 集成 AssetResolver
```
**说明：** 集成资产解析器，用于处理生成的任务结果

#### 3.2 `app/dream-factory/page.tsx:360`
```typescript
// TODO: 实现轮询逻辑
```
**说明：** 实现任务状态轮询，用于检查生成任务的状态

#### 3.3 `backend-api/src/auth/auth.controller.ts:88`
```typescript
// TODO: 从数据库获取用户模式（需要注入 UsersService）
```
**说明：** 这个 TODO 已经完成，代码已经修改为从数据库获取用户模式

---

## 📊 待办事项优先级

### 高优先级（建议优先完成）
- 无（所有核心功能已完成）

### 中优先级（功能增强）
1. **M5.1: 服务器端数据层迁移**
   - 实现跨设备同步
   - 提升用户体验

### 低优先级（可选优化）
1. **M5.1: Cron 任务清理临时文件**
   - 防止临时文件堆积
   - 不影响核心功能

2. **代码中的 TODO 注释**
   - 后续优化项
   - 不影响当前功能

---

## 🎯 建议的下一步

### 选项 1：完成服务器端数据层迁移（推荐）
**理由：**
- 提升用户体验（跨设备同步）
- 数据更安全（服务器端存储）
- 为后续功能扩展打基础

**预计时间：** 3-4 天

### 选项 2：添加 Cron 任务清理临时文件
**理由：**
- 快速完成（0.5 天）
- 防止磁盘空间问题
- 不影响核心功能

**预计时间：** 0.5 天

### 选项 3：处理代码中的 TODO 注释
**理由：**
- 完善功能细节
- 提升代码质量

**预计时间：** 1-2 天

### 选项 4：测试和优化现有功能
**理由：**
- 确保所有功能稳定运行
- 优化用户体验
- 修复潜在问题

**预计时间：** 根据测试结果而定

---

## 📝 总结

**当前状态：**
- ✅ 所有核心功能已完成
- ✅ 所有里程碑（M1-M6）已完成
- ⏳ 剩余待办均为可选优化项

**建议：**
- 如果时间允许，优先完成服务器端数据层迁移
- 如果时间紧张，可以先测试和优化现有功能
- Cron 任务和 TODO 注释可以后续处理

---

**主要功能已完成！剩余待办均为可选优化项。** 🎉







