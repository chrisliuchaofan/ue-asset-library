# 后端充值接口说明

## 问题
后端服务器上找不到 `backend-api` 目录，无法直接重启服务。

## 解决方案

### 方案 1：使用 PM2 重启（推荐）

如果后端使用 PM2 管理，可以直接重启：

```bash
# 查看所有 PM2 进程
pm2 list

# 找到后端服务进程（可能是 ue-assets-backend-api 或其他名称）
# 重启后端服务
pm2 restart <进程名称>

# 或者重启所有进程
pm2 restart all
```

### 方案 2：直接操作数据库（临时方案）

如果无法重启后端，可以直接在数据库中插入充值记录：

```sql
-- PostgreSQL 示例
-- 1. 先查询当前余额
SELECT COALESCE(SUM(amount), 0) as balance 
FROM credit_transactions 
WHERE user_id = 'test@factory-buy.com';

-- 2. 插入充值记录（增加 100 积分）
INSERT INTO credit_transactions (
  user_id, 
  amount, 
  action, 
  description, 
  balance_after, 
  created_at
)
SELECT 
  'test@factory-buy.com',  -- 替换为实际用户邮箱
  100,                      -- 充值金额
  'admin_recharge',
  '管理员充值',
  COALESCE(SUM(amount), 0) + 100,  -- 新余额
  NOW()
FROM credit_transactions 
WHERE user_id = 'test@factory-buy.com';

-- 3. 更新用户表的缓存余额（可选，系统会自动同步）
UPDATE users 
SET credits = (
  SELECT COALESCE(SUM(amount), 0) 
  FROM credit_transactions 
  WHERE user_id = users.id
)
WHERE id = 'test@factory-buy.com';
```

### 方案 3：查找后端代码位置

在服务器上查找后端代码：

```bash
# 查找 credits.controller.ts 文件
find / -name "credits.controller.ts" 2>/dev/null

# 查找 package.json（后端）
find / -name "package.json" -path "*/backend-api/*" 2>/dev/null

# 查找 PM2 配置文件
find / -name "ecosystem.config.js" 2>/dev/null
```

### 方案 4：重新部署后端代码

如果后端代码已经修改（添加了充值接口），需要：

1. 将修改后的代码上传到服务器
2. 重新编译（如果需要）：
   ```bash
   cd <后端代码目录>
   npm install
   npm run build
   ```
3. 重启服务

## 已修改的文件

- `backend-api/src/credits/credits.controller.ts` - 添加了 `POST /credits/recharge` 接口

## 注意事项

- 充值接口在生产环境默认禁用（需要设置 `ALLOW_RECHARGE=true` 才能使用）
- 充值会记录在 `credit_transactions` 表中，保持账本一致性
- 建议使用方案 2（直接操作数据库）作为临时解决方案







