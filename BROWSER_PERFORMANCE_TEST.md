# 浏览器端性能测试指南

## 为什么需要浏览器测试？

Node.js 环境下的页面加载测试可能因为 SSR 限制而失败，但**这不影响 API 性能评估**。如果需要测试真实的页面加载性能，应该在浏览器中进行。

## 快速测试方法

### 方法1: 使用浏览器控制台脚本

1. **打开浏览器开发者工具** (F12 或 Cmd+Option+I)
2. **切换到 Console 标签**
3. **复制并运行** `scripts/test-browser-performance.js` 中的代码
4. **刷新页面或导航到不同页面**
5. **查看控制台输出的性能报告**

### 方法2: 使用浏览器 DevTools

1. **打开开发者工具** → **Network 标签**
2. **刷新页面**
3. **查看加载时间**：
   - DOMContentLoaded
   - Load
   - 各个资源的加载时间

4. **切换到 Performance 标签**
5. **点击录制** → **刷新页面** → **停止录制**
6. **查看性能分析**：
   - First Contentful Paint (FCP)
   - Largest Contentful Paint (LCP)
   - Time to Interactive (TTI)

### 方法3: 使用 Lighthouse

1. **打开开发者工具** → **Lighthouse 标签**
2. **选择测试类型**（Performance）
3. **点击"Generate report"**
4. **查看详细性能报告**

## 性能基准

### 页面加载时间

- **优秀**: < 1000ms
- **良好**: 1000-2000ms
- **一般**: 2000-3000ms
- **较差**: > 3000ms

### Core Web Vitals

- **LCP (Largest Contentful Paint)**: < 2.5s
- **FID (First Input Delay)**: < 100ms
- **CLS (Cumulative Layout Shift)**: < 0.1

## 测试场景

### 1. 资产列表页 (`/assets`)

测试步骤：
1. 访问 `/assets` 页面
2. 等待页面完全加载
3. 记录加载时间
4. 测试滚动性能（大量数据时）

### 2. 素材列表页 (`/materials`)

测试步骤：
1. 访问 `/materials` 页面
2. 等待页面完全加载
3. 记录加载时间
4. 测试筛选和搜索性能

### 3. 资产详情页 (`/assets/[id]`)

测试步骤：
1. 访问任意资产详情页
2. 等待图片/视频加载
3. 测试画廊切换性能

## 性能优化检查清单

### ✅ 已实现的优化

- [x] 图片懒加载
- [x] 图片尺寸优化（OSS处理）
- [x] 虚拟滚动（大量数据）
- [x] API请求防抖
- [x] API响应缓存（30秒TTL）
- [x] 代码分割和按需加载

### 🔍 需要关注的指标

1. **首屏加载时间**
   - 关注首次内容绘制时间
   - 检查是否有阻塞资源

2. **交互响应时间**
   - 搜索响应时间
   - 筛选响应时间
   - 页面切换时间

3. **内存使用**
   - 长时间使用后内存是否增长
   - 是否有内存泄漏

4. **网络请求**
   - API响应时间
   - 图片加载时间
   - 请求数量是否合理

## 常见问题

### Q: 为什么 Node.js 测试中页面加载失败？

A: Node.js 环境下的 fetch 对 SSR 页面支持有限，这是正常的。**API 测试通过就说明后端性能良好**。页面加载性能应该在浏览器中测试。

### Q: 如何判断性能是否达标？

A: 主要关注：
1. **API响应时间** < 500ms（已达标 ✅）
2. **页面加载时间** < 2000ms（在浏览器中测试）
3. **交互响应** < 300ms

### Q: 如果性能不达标怎么办？

A: 参考 `PERFORMANCE_TEST.md` 中的优化建议：
- 增加缓存
- 优化查询
- 使用CDN
- 代码分割

## 自动化测试（可选）

如果需要自动化浏览器测试，可以考虑：

1. **Playwright** - 现代浏览器自动化
2. **Puppeteer** - Chrome/Chromium 自动化
3. **WebPageTest** - 在线性能测试工具

这些工具可以模拟真实用户行为，提供更准确的性能数据。



