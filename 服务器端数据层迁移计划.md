# æœåŠ¡å™¨ç«¯æ•°æ®å±‚è¿ç§»è®¡åˆ’

## ğŸ“‹ å½“å‰çŠ¶æ€

### æœ¬åœ°å­˜å‚¨çš„æ•°æ®

1. **Dream Factory é¡¹ç›®æ•°æ®**ï¼ˆ`lib/dream-factory/project-storage.ts`ï¼‰
   - å­˜å‚¨ä½ç½®ï¼š`localStorage`
   - æ•°æ®å†…å®¹ï¼š
     - é¡¹ç›® IDã€æ ‡é¢˜
     - åŸå§‹åˆ›æ„ï¼ˆoriginalIdeaï¼‰
     - é€‰ä¸­çš„æ¦‚å¿µï¼ˆselectedConceptï¼‰
     - æ•…äº‹æ¿ï¼ˆstoryboardï¼‰
     - åˆ›å»ºæ—¶é—´ã€æ›´æ–°æ—¶é—´ã€å®Œæˆæ—¶é—´
   - é—®é¢˜ï¼š
     - âŒ åªå­˜å‚¨åœ¨æµè§ˆå™¨ä¸­ï¼Œæ¢è®¾å¤‡å°±ä¸¢å¤±
     - âŒ æ— æ³•è·¨è®¾å¤‡åŒæ­¥
     - âŒ æ•°æ®ä¸å®‰å…¨ï¼ˆæµè§ˆå™¨æ¸…ç†ä¼šä¸¢å¤±ï¼‰
     - âŒ æ— æ³•å¤‡ä»½å’Œæ¢å¤

2. **èµ„äº§æ•°æ®**ï¼ˆ`lib/storage.ts`ï¼‰
   - å­˜å‚¨ä½ç½®ï¼š`data/manifest.json`ï¼ˆæœ¬åœ°æ–‡ä»¶ï¼‰
   - æ•°æ®å†…å®¹ï¼šèµ„äº§æ¸…å•
   - çŠ¶æ€ï¼šå·²æœ‰ OSS æ¨¡å¼é¢„ç•™ï¼Œä½†ä¸»è¦ä½¿ç”¨æœ¬åœ°æ–‡ä»¶

---

## ğŸ¯ è¿ç§»ç›®æ ‡

### ä¼˜å…ˆçº§ 1ï¼šDream Factory é¡¹ç›®æ•°æ®ï¼ˆæœ€é‡è¦ï¼‰

**åŸå› ï¼š**
- ç”¨æˆ·åˆ›å»ºçš„é¡¹ç›®æ˜¯æ ¸å¿ƒæ•°æ®
- éœ€è¦è·¨è®¾å¤‡åŒæ­¥
- éœ€è¦æŒä¹…åŒ–å­˜å‚¨

**è¿ç§»æ–¹æ¡ˆï¼š**
1. åˆ›å»ºåç«¯å®ä½“ï¼š`Project` entity
2. åˆ›å»ºåç«¯ APIï¼šä¿å­˜ã€è·å–ã€åˆ é™¤ã€æ›´æ–°é¡¹ç›®
3. ä¿®æ”¹å‰ç«¯å­˜å‚¨é€»è¾‘ï¼šä» localStorage æ”¹ä¸ºè°ƒç”¨åç«¯ API
4. ä¿æŒå‘åå…¼å®¹ï¼šå¦‚æœåç«¯ä¸å¯ç”¨ï¼Œå›é€€åˆ° localStorage

---

## ğŸ“ å®æ–½è®¡åˆ’

### é˜¶æ®µ 1ï¼šåç«¯æ•°æ®å±‚ï¼ˆæ•°æ®åº“å®ä½“å’Œ APIï¼‰

#### 1.1 åˆ›å»º Project å®ä½“

**æ–‡ä»¶ï¼š** `backend-api/src/database/entities/project.entity.ts`

```typescript
@Entity('projects')
export class Project {
  @PrimaryGeneratedColumn('uuid')
  id: string;

  @Column()
  userId: string; // å…³è”ç”¨æˆ·

  @Column()
  title: string;

  @Column('text')
  originalIdea: string;

  @Column('jsonb', { nullable: true })
  selectedConcept: any; // Concept å¯¹è±¡

  @Column('jsonb')
  storyboard: any[]; // Scene[] æ•°ç»„

  @Column({ nullable: true })
  mergedVideoUrl?: string;

  @CreateDateColumn()
  createdAt: Date;

  @UpdateDateColumn()
  updatedAt: Date;

  @Column({ nullable: true })
  completedAt?: Date;
}
```

#### 1.2 åˆ›å»º Projects Service

**æ–‡ä»¶ï¼š** `backend-api/src/projects/projects.service.ts`

**åŠŸèƒ½ï¼š**
- `create(userId, projectData)` - åˆ›å»ºé¡¹ç›®
- `findAll(userId)` - è·å–ç”¨æˆ·æ‰€æœ‰é¡¹ç›®
- `findOne(id, userId)` - è·å–å•ä¸ªé¡¹ç›®
- `update(id, userId, updates)` - æ›´æ–°é¡¹ç›®
- `delete(id, userId)` - åˆ é™¤é¡¹ç›®

#### 1.3 åˆ›å»º Projects Controller

**æ–‡ä»¶ï¼š** `backend-api/src/projects/projects.controller.ts`

**API ç«¯ç‚¹ï¼š**
- `POST /projects` - åˆ›å»ºé¡¹ç›®
- `GET /projects` - è·å–ç”¨æˆ·æ‰€æœ‰é¡¹ç›®
- `GET /projects/:id` - è·å–å•ä¸ªé¡¹ç›®
- `PATCH /projects/:id` - æ›´æ–°é¡¹ç›®
- `DELETE /projects/:id` - åˆ é™¤é¡¹ç›®

---

### é˜¶æ®µ 2ï¼šå‰ç«¯ API è·¯ç”±

#### 2.1 åˆ›å»ºå‰ç«¯ API è·¯ç”±

**æ–‡ä»¶ï¼š**
- `app/api/projects/route.ts` - åˆ›å»ºå’Œè·å–é¡¹ç›®åˆ—è¡¨
- `app/api/projects/[id]/route.ts` - è·å–ã€æ›´æ–°ã€åˆ é™¤å•ä¸ªé¡¹ç›®

**åŠŸèƒ½ï¼š**
- ä»£ç†åç«¯ API è°ƒç”¨
- å¤„ç†è®¤è¯ï¼ˆè‡ªåŠ¨æºå¸¦ tokenï¼‰
- é”™è¯¯å¤„ç†

---

### é˜¶æ®µ 3ï¼šå‰ç«¯å­˜å‚¨å±‚æ”¹é€ 

#### 3.1 ä¿®æ”¹ project-storage.ts

**ç­–ç•¥ï¼š**
- ä¼˜å…ˆä½¿ç”¨åç«¯ API
- å¦‚æœåç«¯ä¸å¯ç”¨ï¼Œå›é€€åˆ° localStorage
- æä¾›ç»Ÿä¸€çš„æ¥å£ï¼ˆä¸æ”¹å˜ç°æœ‰è°ƒç”¨æ–¹å¼ï¼‰

**æ–°æ¥å£ï¼š**
```typescript
// ä¿æŒç°æœ‰æ¥å£ä¸å˜
export function saveProject(project: ProjectState, title?: string): Promise<string>
export function getAllSavedProjects(): Promise<SavedProject[]>
export function getProject(projectId: string): Promise<SavedProject | null>
export function updateProject(projectId: string, updates: Partial<SavedProject>): Promise<void>
export function deleteProject(projectId: string): Promise<void>
```

**å®ç°é€»è¾‘ï¼š**
1. å°è¯•è°ƒç”¨åç«¯ API
2. å¦‚æœæˆåŠŸï¼Œè¿”å›ç»“æœ
3. å¦‚æœå¤±è´¥ï¼ˆç½‘ç»œé”™è¯¯ã€åç«¯ä¸å¯ç”¨ï¼‰ï¼Œå›é€€åˆ° localStorage
4. è®°å½•æ—¥å¿—ï¼Œæ–¹ä¾¿æ’æŸ¥

---

### é˜¶æ®µ 4ï¼šæ•°æ®è¿ç§»ï¼ˆå¯é€‰ï¼‰

#### 4.1 è¿ç§»ç°æœ‰ localStorage æ•°æ®

**åŠŸèƒ½ï¼š**
- æ£€æµ‹ localStorage ä¸­æ˜¯å¦æœ‰é¡¹ç›®æ•°æ®
- å¦‚æœæœ‰ï¼Œå°è¯•ä¸Šä¼ åˆ°æœåŠ¡å™¨
- ä¸Šä¼ æˆåŠŸåï¼Œæ¸…é™¤ localStorage æ•°æ®

**è§¦å‘æ—¶æœºï¼š**
- ç”¨æˆ·ç™»å½•å
- é¦–æ¬¡è®¿é—® Dream Factory é¡µé¢æ—¶

---

## ğŸ”§ æŠ€æœ¯ç»†èŠ‚

### æ•°æ®åº“è®¾è®¡

**è¡¨åï¼š** `projects`

**å­—æ®µï¼š**
- `id` (UUID, Primary Key)
- `user_id` (String, Foreign Key -> users.id)
- `title` (String)
- `original_idea` (Text)
- `selected_concept` (JSONB, nullable)
- `storyboard` (JSONB)
- `merged_video_url` (String, nullable)
- `created_at` (Timestamp)
- `updated_at` (Timestamp)
- `completed_at` (Timestamp, nullable)

**ç´¢å¼•ï¼š**
- `user_id` + `created_at` (ç”¨äºå¿«é€ŸæŸ¥è¯¢ç”¨æˆ·é¡¹ç›®åˆ—è¡¨)
- `user_id` + `updated_at` (ç”¨äºæ’åº)

---

### API è®¾è®¡

#### POST /projects
**è¯·æ±‚ï¼š**
```json
{
  "title": "é¡¹ç›®æ ‡é¢˜",
  "originalIdea": "åŸå§‹åˆ›æ„",
  "selectedConcept": { ... },
  "storyboard": [ ... ]
}
```

**å“åº”ï¼š**
```json
{
  "id": "uuid",
  "title": "é¡¹ç›®æ ‡é¢˜",
  "originalIdea": "åŸå§‹åˆ›æ„",
  "selectedConcept": { ... },
  "storyboard": [ ... ],
  "createdAt": "2024-12-15T10:00:00Z",
  "updatedAt": "2024-12-15T10:00:00Z"
}
```

#### GET /projects
**å“åº”ï¼š**
```json
{
  "projects": [
    {
      "id": "uuid",
      "title": "é¡¹ç›®æ ‡é¢˜",
      "originalIdea": "åŸå§‹åˆ›æ„",
      "createdAt": "2024-12-15T10:00:00Z",
      "updatedAt": "2024-12-15T10:00:00Z"
    }
  ]
}
```

---

## ğŸ“… å®æ–½æ—¶é—´è¡¨

### å»ºè®®ï¼šM6 ä¹‹åå®æ–½

**åŸå› ï¼š**
- M6 æ˜¯åŠŸèƒ½å¢å¼ºï¼Œä¸æ¶‰åŠæ•°æ®å±‚
- æ•°æ®å±‚è¿ç§»æ˜¯ç‹¬ç«‹çš„åŠŸèƒ½ï¼Œå¯ä»¥å•ç‹¬è§„åˆ’
- éœ€è¦ç¡®ä¿ M1-M5 éƒ½ç¨³å®šåå†è¿ç§»

**æˆ–è€…ï¼šä½œä¸º M7 å®æ–½**

**M7ï¼šæœåŠ¡å™¨ç«¯æ•°æ®å±‚è¿ç§»**
- ç›®æ ‡ï¼šå°† Dream Factory é¡¹ç›®æ•°æ®è¿ç§»åˆ°æœåŠ¡å™¨ç«¯
- æ—¶é—´ï¼š3-4 å¤©
- ä¾èµ–ï¼šM1, M2, M3ï¼ˆéœ€è¦ç”¨æˆ·èº«ä»½é“¾è·¯ã€æ•°æ®åº“æ­£å¸¸ï¼‰

---

## âœ… éªŒæ”¶æ ‡å‡†

1. **åŠŸèƒ½å®Œæ•´æ€§**
   - âœ… å¯ä»¥ä¿å­˜é¡¹ç›®åˆ°æœåŠ¡å™¨
   - âœ… å¯ä»¥è·å–é¡¹ç›®åˆ—è¡¨
   - âœ… å¯ä»¥æ›´æ–°é¡¹ç›®
   - âœ… å¯ä»¥åˆ é™¤é¡¹ç›®
   - âœ… åç«¯ä¸å¯ç”¨æ—¶ï¼Œå›é€€åˆ° localStorage

2. **æ•°æ®ä¸€è‡´æ€§**
   - âœ… é¡¹ç›®æ•°æ®æ­£ç¡®ä¿å­˜åˆ°æ•°æ®åº“
   - âœ… é¡¹ç›®ä¸ç”¨æˆ·æ­£ç¡®å…³è”
   - âœ… æ—¶é—´æˆ³æ­£ç¡®è®°å½•

3. **ç”¨æˆ·ä½“éªŒ**
   - âœ… ä¿å­˜/åŠ è½½é€Ÿåº¦å¯æ¥å—
   - âœ… é”™è¯¯æç¤ºå‹å¥½
   - âœ… æ•°æ®è¿ç§»è¿‡ç¨‹é€æ˜

---

## ğŸš€ ç«‹å³å®æ–½ï¼Ÿ

**é€‰é¡¹ 1ï¼šç°åœ¨å®æ–½ï¼ˆæ¨èï¼‰**
- âœ… æ•°æ®å±‚è¿ç§»æ˜¯åŸºç¡€åŠŸèƒ½ï¼Œè¶Šæ—©åšè¶Šå¥½
- âœ… å¯ä»¥ç¡®ä¿æ•°æ®å®‰å…¨
- âœ… æ”¯æŒè·¨è®¾å¤‡åŒæ­¥

**é€‰é¡¹ 2ï¼šM6 ä¹‹åå®æ–½**
- âœ… å…ˆå®Œæˆ M6ï¼ˆDry Run UIï¼‰
- âœ… ç„¶åä½œä¸º M7 å®æ–½æ•°æ®å±‚è¿ç§»

**ä½ çš„é€‰æ‹©ï¼Ÿ**


