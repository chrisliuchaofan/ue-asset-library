# GitHub Actions è‡ªåŠ¨éƒ¨ç½²è¯´æ˜

## âœ… è‡ªåŠ¨éƒ¨ç½²é…ç½®

é¡¹ç›®å·²é…ç½® GitHub Actions è‡ªåŠ¨éƒ¨ç½²åç«¯ä»£ç åˆ° ECS æœåŠ¡å™¨ã€‚

### è§¦å‘æ¡ä»¶

å½“æ»¡è¶³ä»¥ä¸‹æ¡ä»¶æ—¶ï¼Œä¼šè‡ªåŠ¨è§¦å‘éƒ¨ç½²ï¼š
1. ä»£ç æ¨é€åˆ° `main` åˆ†æ”¯
2. å˜æ›´çš„æ–‡ä»¶åŒ…å« `backend-api/**` ç›®å½•ä¸‹çš„æ–‡ä»¶
3. æˆ–å˜æ›´äº† `.github/workflows/deploy-backend.yml` æ–‡ä»¶

### éƒ¨ç½²æµç¨‹

1. **æ£€å‡ºä»£ç ** - ä» GitHub æ‹‰å–æœ€æ–°ä»£ç 
2. **å®‰è£…ä¾èµ–** - åœ¨ GitHub Actions ç¯å¢ƒä¸­å®‰è£… Node.js ä¾èµ–
3. **æ„å»ºåç«¯** - ç¼–è¯‘ TypeScript ä»£ç 
4. **éƒ¨ç½²åˆ°æœåŠ¡å™¨** - é€šè¿‡ SSH è¿æ¥åˆ° ECS æœåŠ¡å™¨
5. **é‡å¯æœåŠ¡** - ä½¿ç”¨ PM2 é‡å¯åç«¯æœåŠ¡

## âš™ï¸ éœ€è¦é…ç½®çš„ GitHub Secrets

åœ¨ GitHub ä»“åº“è®¾ç½®ä¸­ï¼Œéœ€è¦é…ç½®ä»¥ä¸‹ Secretsï¼š

1. **ECS_HOST** - ECS æœåŠ¡å™¨çš„ IP åœ°å€æˆ–åŸŸå
   ```
   ä¾‹å¦‚: 123.456.789.0 æˆ– api.your-domain.com
   ```

2. **ECS_USERNAME** - SSH ç™»å½•ç”¨æˆ·å
   ```
   ä¾‹å¦‚: root
   ```

3. **ECS_SSH_KEY** - SSH ç§é’¥
   ```
   ç”Ÿæˆ SSH å¯†é’¥å¯¹ï¼ˆå¦‚æœè¿˜æ²¡æœ‰ï¼‰:
   ssh-keygen -t rsa -b 4096 -C "github-actions"
   
   å°†å…¬é’¥æ·»åŠ åˆ°æœåŠ¡å™¨çš„ ~/.ssh/authorized_keys
   å°†ç§é’¥å†…å®¹æ·»åŠ åˆ° GitHub Secrets çš„ ECS_SSH_KEY
   ```

### é…ç½®æ­¥éª¤

1. è®¿é—® GitHub ä»“åº“
2. ç‚¹å‡» **Settings** â†’ **Secrets and variables** â†’ **Actions**
3. ç‚¹å‡» **New repository secret**
4. æ·»åŠ ä¸Šè¿°ä¸‰ä¸ª Secrets

## ğŸ” æŸ¥çœ‹éƒ¨ç½²çŠ¶æ€

1. è®¿é—® GitHub ä»“åº“
2. ç‚¹å‡» **Actions** æ ‡ç­¾
3. æŸ¥çœ‹ "Deploy Backend to ECS" workflow çš„æ‰§è¡ŒçŠ¶æ€

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **é¦–æ¬¡éƒ¨ç½²**ï¼šéœ€è¦æ‰‹åŠ¨é…ç½® GitHub Secrets
2. **SSH å¯†é’¥**ï¼šç¡®ä¿æœåŠ¡å™¨çš„ `~/.ssh/authorized_keys` åŒ…å« GitHub Actions ä½¿ç”¨çš„å…¬é’¥
3. **æ„å»ºæ–¹å¼**ï¼šå½“å‰é…ç½®ä¼šåœ¨ GitHub Actions ä¸­æ„å»ºï¼Œç„¶åéƒ¨ç½²åˆ°æœåŠ¡å™¨
4. **æœåŠ¡å™¨è¦æ±‚**ï¼šæœåŠ¡å™¨ä¸Šéœ€è¦æœ‰ Node.jsã€npm å’Œ PM2

## ğŸ”„ å¦‚æœè‡ªåŠ¨éƒ¨ç½²å¤±è´¥

### æ£€æŸ¥æ¸…å•

1. **GitHub Secrets æ˜¯å¦é…ç½®**
   - Settings â†’ Secrets and variables â†’ Actions

2. **SSH è¿æ¥æ˜¯å¦æ­£å¸¸**
   - æ‰‹åŠ¨æµ‹è¯•ï¼š`ssh -i <private-key> <username>@<host>`

3. **æœåŠ¡å™¨è·¯å¾„æ˜¯å¦æ­£ç¡®**
   - ç¡®è®¤ `/opt/ue-assets-backend/backend-api` ç›®å½•å­˜åœ¨

4. **PM2 è¿›ç¨‹åç§°**
   - ç¡®è®¤è¿›ç¨‹åç§°æ˜¯ `ue-assets-backend`

### æ‰‹åŠ¨éƒ¨ç½²ï¼ˆå¤‡ç”¨æ–¹æ¡ˆï¼‰

å¦‚æœè‡ªåŠ¨éƒ¨ç½²å¤±è´¥ï¼Œå¯ä»¥ä½¿ç”¨æ‰‹åŠ¨éƒ¨ç½²ï¼š

```bash
./scripts/deploy-backend.sh <æœåŠ¡å™¨IP> <ç”¨æˆ·å>
```

## ğŸ“ æœ¬æ¬¡éƒ¨ç½²

ç”±äºä»£ç å·²ç»æ¨é€åˆ° GitHubï¼Œå¦‚æœ GitHub Secrets å·²é…ç½®ï¼Œè‡ªåŠ¨éƒ¨ç½²åº”è¯¥å·²ç»è§¦å‘ã€‚

**æ£€æŸ¥æ–¹æ³•**ï¼š
1. è®¿é—® GitHub ä»“åº“
2. ç‚¹å‡» **Actions** æ ‡ç­¾
3. æŸ¥çœ‹æ˜¯å¦æœ‰ "Deploy Backend to ECS" çš„ workflow è¿è¡Œ

