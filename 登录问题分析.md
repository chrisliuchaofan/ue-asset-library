# ç™»å½•é—®é¢˜åˆ†æï¼šä¸ºä»€ä¹ˆ admin/admin123 è¿˜èƒ½ç™»å½•ï¼Ÿ

## ğŸ” é—®é¢˜åˆ†æ

**ç°è±¡ï¼š** å³ä½¿ç”¨æˆ·éƒ¨ç½²æˆåŠŸï¼Œä½¿ç”¨ `admin/admin123` ä»ç„¶å¯ä»¥ç™»å½•ã€‚

**åŸå› ï¼š** åç«¯çš„ç™»å½•é€»è¾‘**ä¼˜å…ˆæ£€æŸ¥ç™½åå•**ï¼Œè€Œä¸æ˜¯æ•°æ®åº“ã€‚

---

## ğŸ“‹ å½“å‰ç™»å½•é€»è¾‘

### åç«¯ `AuthService.login()` æ–¹æ³•ï¼š

```typescript
async login(email: string, password: string, isAdmin: boolean = false) {
  // 1. å…ˆæ£€æŸ¥ç™½åå•ï¼ˆUSER_WHITELIST æˆ– ADMIN_WHITELISTï¼‰
  const adminWhitelist = this.getAdminWhitelistUsers();
  const adminUser = adminWhitelist.find(...);
  
  if (adminUser) {
    // ç™½åå•ç”¨æˆ·ç™»å½•æˆåŠŸï¼Œç›´æ¥è¿”å› tokenï¼ˆä¸éªŒè¯æ•°æ®åº“ï¼‰
    return { token, ... };
  }
  
  // 2. å¦‚æœä¸åœ¨ç™½åå•ï¼Œæ‰å°è¯•ä»æ•°æ®åº“éªŒè¯
  const result = await this.usersService.login(email, password);
  return { token, ... };
}
```

**å…³é”®ç‚¹ï¼š**
- ç™½åå•ä¼˜å…ˆçº§**é«˜äº**æ•°æ®åº“éªŒè¯
- å¦‚æœç¯å¢ƒå˜é‡ `USER_WHITELIST` æˆ– `ADMIN_WHITELIST` ä¸­åŒ…å« `admin:admin123`ï¼Œå°±èƒ½ç™»å½•
- å³ä½¿æ•°æ®åº“ä¸­æ²¡æœ‰è¿™ä¸ªç”¨æˆ·ï¼Œä¹Ÿèƒ½ç™»å½•

---

## ğŸ”§ è§£å†³æ–¹æ¡ˆ

### æ–¹æ¡ˆ 1ï¼šç§»é™¤æœåŠ¡å™¨ä¸Šçš„ç™½åå•é…ç½®ï¼ˆæ¨èï¼‰

**æ­¥éª¤ï¼š**
1. SSH è¿æ¥åˆ°æœåŠ¡å™¨
2. ç¼–è¾‘åç«¯ `.env` æ–‡ä»¶ï¼š
   ```bash
   ssh root@your-server-ip
   cd /opt/ue-assets-backend/backend-api
   nano .env
   ```
3. åˆ é™¤æˆ–æ³¨é‡Šæ‰ `USER_WHITELIST` æˆ– `ADMIN_WHITELIST`ï¼š
   ```bash
   # USER_WHITELIST=admin:admin123  # æ³¨é‡Šæ‰
   ```
4. é‡å¯åç«¯æœåŠ¡ï¼š
   ```bash
   pm2 restart ue-assets-backend --update-env
   ```

**æ•ˆæœï¼š** ç§»é™¤ç™½åå•åï¼Œæ‰€æœ‰ç”¨æˆ·å¿…é¡»é€šè¿‡æ•°æ®åº“éªŒè¯æ‰èƒ½ç™»å½•ã€‚

---

### æ–¹æ¡ˆ 2ï¼šä¿®æ”¹ç™»å½•é€»è¾‘ï¼ˆä»…æ•°æ®åº“éªŒè¯ï¼‰

**ä¿®æ”¹ `backend-api/src/auth/auth.service.ts`ï¼š**

```typescript
async login(email: string, password: string, isAdmin: boolean = false) {
  // ç§»é™¤ç™½åå•æ£€æŸ¥ï¼Œç›´æ¥ä½¿ç”¨æ•°æ®åº“éªŒè¯
  try {
    const result = await this.usersService.login(email, password);
    return {
      success: true,
      userId: result.user.id,
      email: result.user.email,
      name: result.user.name,
      token: result.token,
      isAdmin: result.user.isAdmin || false,
    };
  } catch (error) {
    throw new UnauthorizedException('é‚®ç®±æˆ–å¯†ç é”™è¯¯');
  }
}
```

**æ•ˆæœï¼š** æ‰€æœ‰ç”¨æˆ·å¿…é¡»é€šè¿‡æ•°æ®åº“éªŒè¯ï¼Œç™½åå•å¤±æ•ˆã€‚

---

### æ–¹æ¡ˆ 3ï¼šä¿ç•™ç™½åå•ä½†é™ä½ä¼˜å…ˆçº§ï¼ˆå¼€å‘ç¯å¢ƒï¼‰

**ä¿®æ”¹ `backend-api/src/auth/auth.service.ts`ï¼š**

```typescript
async login(email: string, password: string, isAdmin: boolean = false) {
  // å…ˆå°è¯•æ•°æ®åº“éªŒè¯
  try {
    const result = await this.usersService.login(email, password);
    return { ... };
  } catch (error) {
    // æ•°æ®åº“éªŒè¯å¤±è´¥ï¼Œå†æ£€æŸ¥ç™½åå•ï¼ˆä»…å¼€å‘ç¯å¢ƒï¼‰
    if (process.env.NODE_ENV === 'development') {
      const adminWhitelist = this.getAdminWhitelistUsers();
      const adminUser = adminWhitelist.find(...);
      if (adminUser) {
        return { ... };
      }
    }
    throw new UnauthorizedException('é‚®ç®±æˆ–å¯†ç é”™è¯¯');
  }
}
```

**æ•ˆæœï¼š** ç”Ÿäº§ç¯å¢ƒåªä½¿ç”¨æ•°æ®åº“éªŒè¯ï¼Œå¼€å‘ç¯å¢ƒä¿ç•™ç™½åå•ä½œä¸ºå¤‡ç”¨ã€‚

---

## ğŸ“Š æ£€æŸ¥å½“å‰é…ç½®

### æ£€æŸ¥æœåŠ¡å™¨ä¸Šçš„ç¯å¢ƒå˜é‡ï¼š

```bash
# SSH è¿æ¥åˆ°æœåŠ¡å™¨
ssh root@your-server-ip

# æ£€æŸ¥åç«¯ç¯å¢ƒå˜é‡
cd /opt/ue-assets-backend/backend-api
cat .env | grep -E "USER_WHITELIST|ADMIN_WHITELIST|ADMIN_USERS"
```

### æ£€æŸ¥æ•°æ®åº“ä¸­çš„ç”¨æˆ·ï¼š

```bash
# è¿æ¥åˆ°æ•°æ®åº“
psql -h localhost -U your-username -d ue_assets

# æŸ¥çœ‹ç”¨æˆ·åˆ—è¡¨
SELECT id, email, name FROM users;
```

---

## âœ… æ¨èæ“ä½œ

1. **ç«‹å³æ“ä½œï¼š** ç§»é™¤æœåŠ¡å™¨ä¸Šçš„ `USER_WHITELIST` æˆ– `ADMIN_WHITELIST` é…ç½®
2. **é•¿æœŸæ–¹æ¡ˆï¼š** ä¿®æ”¹ç™»å½•é€»è¾‘ï¼Œä¼˜å…ˆä½¿ç”¨æ•°æ®åº“éªŒè¯
3. **å®‰å…¨å»ºè®®ï¼š** åœ¨ç”Ÿäº§ç¯å¢ƒä¸­å®Œå…¨ç¦ç”¨ç™½åå•ç™»å½•

---

## ğŸ”’ å®‰å…¨å»ºè®®

1. **ç”Ÿäº§ç¯å¢ƒï¼š** å®Œå…¨ç¦ç”¨ç™½åå•ï¼Œåªä½¿ç”¨æ•°æ®åº“ç”¨æˆ·
2. **å¼€å‘ç¯å¢ƒï¼š** å¯ä»¥ä¿ç•™ç™½åå•ï¼Œä½†åº”è¯¥ä½¿ç”¨å¼ºå¯†ç 
3. **ç”¨æˆ·ç®¡ç†ï¼š** æ‰€æœ‰ç”¨æˆ·åº”è¯¥é€šè¿‡æ•°æ®åº“ç®¡ç†ï¼Œè€Œä¸æ˜¯ç¯å¢ƒå˜é‡

---

**éœ€è¦æˆ‘å¸®ä½ ä¿®æ”¹ç™»å½•é€»è¾‘å—ï¼Ÿ**







