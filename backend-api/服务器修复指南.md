# 服务器修复指南

## 问题
`git pull` 失败，因为 `backend-api/package.json` 有本地修改。

## 解决方案

### 步骤 1：保存或丢弃本地修改

**选项 A：保存本地修改（推荐）**
```bash
cd /opt/ue-assets-backend/backend-api
git stash
git pull origin main
git stash pop  # 如果需要恢复本地修改
```

**选项 B：丢弃本地修改（如果确定不需要）**
```bash
cd /opt/ue-assets-backend/backend-api
git reset --hard HEAD
git pull origin main
```

### 步骤 2：安装依赖并构建
```bash
npm install
npm run build
```

### 步骤 3：使用 ecosystem 配置文件启动服务
```bash
pm2 start ecosystem.config.js
pm2 logs ue-assets-backend --lines 30
```

## 如果 ecosystem.config.js 仍然找不到

如果执行 `pm2 start ecosystem.config.js` 仍然报错，可以：

1. **检查文件是否存在：**
```bash
ls -la /opt/ue-assets-backend/backend-api/ecosystem.config.js
```

2. **如果文件不存在，手动创建：**
```bash
cd /opt/ue-assets-backend/backend-api
cat > ecosystem.config.js << 'EOF'
const path = require('path');
require('dotenv').config({ path: path.join(__dirname, '.env') });

module.exports = {
  apps: [
    {
      name: 'ue-assets-backend',
      script: './dist/main.js',
      cwd: '/opt/ue-assets-backend/backend-api',
      instances: 1,
      exec_mode: 'fork',
      env: {
        NODE_ENV: 'production',
        DB_HOST: process.env.DB_HOST,
        DB_PORT: process.env.DB_PORT,
        DB_NAME: process.env.DB_NAME,
        DB_USERNAME: process.env.DB_USERNAME,
        DB_PASSWORD: process.env.DB_PASSWORD,
        FRONTEND_URL: process.env.FRONTEND_URL,
        PORT: process.env.PORT || '3001',
        JWT_SECRET: process.env.JWT_SECRET,
        USER_WHITELIST: process.env.USER_WHITELIST,
        INITIAL_CREDITS: process.env.INITIAL_CREDITS,
      },
      error_file: '/root/.pm2/logs/ue-assets-backend-error.log',
      out_file: '/root/.pm2/logs/ue-assets-backend-out.log',
      log_date_format: 'YYYY-MM-DD HH:mm:ss Z',
      merge_logs: true,
      autorestart: true,
      max_restarts: 10,
      min_uptime: '10s',
      watch: false,
    },
  ],
};
EOF
```

3. **然后启动服务：**
```bash
pm2 start ecosystem.config.js
```

