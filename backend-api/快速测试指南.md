# ğŸš€ å¿«é€Ÿæµ‹è¯•æŒ‡å—

## å‰ç½®æ¡ä»¶

1. **åç«¯æœåŠ¡å·²å¯åŠ¨**
   ```bash
   pm2 status
   ```

2. **é…ç½®æµ‹è¯•ç”¨æˆ·**

   åœ¨æœåŠ¡å™¨ä¸Šçš„ `/opt/ue-assets-backend/backend-api/.env` æ–‡ä»¶ä¸­æ·»åŠ ï¼š

   ```env
   USER_WHITELIST=test@factory-buy.com:password123
   INITIAL_CREDITS=100
   JWT_SECRET=your-secret-key-change-in-production
   ```

   ç„¶åé‡å¯æœåŠ¡ï¼š
   ```bash
   pm2 restart ue-assets-backend --update-env
   ```

---

## æ–¹æ³• 1ï¼šä½¿ç”¨æµè§ˆå™¨æ§åˆ¶å°æµ‹è¯•ï¼ˆæ¨èï¼‰

1. **æ‰“å¼€å‰ç«¯é¡µé¢**
   - è®¿é—®ï¼š`https://www.factory-buy.com`
   - æŒ‰ `F12` æ‰“å¼€å¼€å‘è€…å·¥å…·
   - åˆ‡æ¢åˆ° `Console` æ ‡ç­¾

2. **å¤åˆ¶å¹¶æ‰§è¡Œä»¥ä¸‹ä»£ç **

```javascript
// å®Œæ•´æµ‹è¯•æµç¨‹
(async function() {
  const BACKEND_URL = 'https://api.factory-buy.com';
  const TEST_EMAIL = 'test@factory-buy.com';
  const TEST_PASSWORD = 'password123';
  
  let token = null;
  
  try {
    // 1. å¥åº·æ£€æŸ¥
    console.log('1ï¸âƒ£ æµ‹è¯•å¥åº·æ£€æŸ¥...');
    const healthRes = await fetch(`${BACKEND_URL}/health`);
    const healthData = await healthRes.json();
    console.log('âœ… å¥åº·æ£€æŸ¥:', healthData);
    
    // 2. ç™»å½•
    console.log('\n2ï¸âƒ£ æµ‹è¯•ç™»å½•...');
    const loginRes = await fetch(`${BACKEND_URL}/auth/login`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ email: TEST_EMAIL, password: TEST_PASSWORD })
    });
    const loginData = await loginRes.json();
    if (loginData.token) {
      token = loginData.token;
      console.log('âœ… ç™»å½•æˆåŠŸï¼ŒToken:', token.substring(0, 20) + '...');
    } else {
      console.error('âŒ ç™»å½•å¤±è´¥:', loginData);
      return;
    }
    
    // 3. æŸ¥è¯¢ç§¯åˆ†
    console.log('\n3ï¸âƒ£ æŸ¥è¯¢ç§¯åˆ†ä½™é¢...');
    const balanceRes = await fetch(`${BACKEND_URL}/credits/balance`, {
      headers: {
        'Authorization': `Bearer ${token}`,
        'X-User-Id': TEST_EMAIL
      }
    });
    const balanceData = await balanceRes.json();
    console.log('âœ… ç§¯åˆ†ä½™é¢:', balanceData);
    
    // 4. æ¶ˆè´¹ç§¯åˆ†
    console.log('\n4ï¸âƒ£ æ¶ˆè´¹ç§¯åˆ†...');
    const consumeRes = await fetch(`${BACKEND_URL}/credits/consume`, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'Authorization': `Bearer ${token}`,
        'X-User-Id': TEST_EMAIL
      },
      body: JSON.stringify({ amount: 5, action: 'test' })
    });
    const consumeData = await consumeRes.json();
    console.log('âœ… æ¶ˆè´¹ç§¯åˆ†æˆåŠŸ:', consumeData);
    
    // 5. åˆ›å»ºæ—¥å¿—
    console.log('\n5ï¸âƒ£ åˆ›å»ºæ—¥å¿—...');
    const logRes = await fetch(`${BACKEND_URL}/logs/create`, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'Authorization': `Bearer ${token}`,
        'X-User-Id': TEST_EMAIL
      },
      body: JSON.stringify({
        action: 'test',
        details: { test: true },
        success: true,
        timestamp: new Date().toISOString()
      })
    });
    const logData = await logRes.json();
    console.log('âœ… åˆ›å»ºæ—¥å¿—æˆåŠŸ:', logData);
    
    console.log('\nğŸ‰ æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼');
  } catch (error) {
    console.error('âŒ æµ‹è¯•å¤±è´¥:', error);
  }
})();
```

---

## æ–¹æ³• 2ï¼šä½¿ç”¨ Node.js æµ‹è¯•è„šæœ¬

1. **åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œ**

```bash
cd /opt/ue-assets-backend/backend-api

# è®¾ç½®ç¯å¢ƒå˜é‡
export BACKEND_URL=https://api.factory-buy.com
export TEST_EMAIL=test@factory-buy.com
export TEST_PASSWORD=password123

# è¿è¡Œæµ‹è¯•è„šæœ¬
node test-integration.js
```

---

## æ–¹æ³• 3ï¼šä½¿ç”¨ curl å‘½ä»¤æµ‹è¯•

```bash
# 1. å¥åº·æ£€æŸ¥
curl https://api.factory-buy.com/health

# 2. ç™»å½•ï¼ˆéœ€è¦å…ˆé…ç½®ç”¨æˆ·ï¼‰
curl -X POST https://api.factory-buy.com/auth/login \
  -H "Content-Type: application/json" \
  -d '{"email":"test@factory-buy.com","password":"password123"}'

# 3. æŸ¥è¯¢ç§¯åˆ†ï¼ˆä½¿ç”¨ç™»å½•è·å¾—çš„ tokenï¼‰
curl https://api.factory-buy.com/credits/balance \
  -H "Authorization: Bearer YOUR_TOKEN_HERE" \
  -H "X-User-Id: test@factory-buy.com"
```

---

## é¢„æœŸç»“æœ

### å¥åº·æ£€æŸ¥
```json
{
  "status": "ok",
  "timestamp": 1234567890
}
```

### ç™»å½•æˆåŠŸ
```json
{
  "success": true,
  "userId": "test@factory-buy.com",
  "email": "test@factory-buy.com",
  "name": "test",
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
}
```

### æŸ¥è¯¢ç§¯åˆ†
```json
{
  "balance": 100
}
```

### æ¶ˆè´¹ç§¯åˆ†
```json
{
  "success": true,
  "balance": 95,
  "transactionId": "txn-1234567890-abc123"
}
```

### åˆ›å»ºæ—¥å¿—
```json
{
  "logId": "uuid-12345678-1234-1234-1234-123456789abc"
}
```

---

## å¸¸è§é—®é¢˜

### é—®é¢˜ 1ï¼šç™»å½•å¤±è´¥ "é‚®ç®±æˆ–å¯†ç é”™è¯¯"

**åŸå› ï¼š** ç”¨æˆ·æœªé…ç½®åœ¨ `USER_WHITELIST` ä¸­

**è§£å†³ï¼š**
1. æ£€æŸ¥ `.env` æ–‡ä»¶ä¸­çš„ `USER_WHITELIST` é…ç½®
2. æ ¼å¼ï¼š`email:password,email2:password2`
3. é‡å¯æœåŠ¡ï¼š`pm2 restart ue-assets-backend --update-env`

### é—®é¢˜ 2ï¼š401 æœªæˆæƒ

**åŸå› ï¼š** Token æ— æ•ˆæˆ–è¿‡æœŸ

**è§£å†³ï¼š**
1. é‡æ–°ç™»å½•è·å–æ–° token
2. æ£€æŸ¥ `JWT_SECRET` ç¯å¢ƒå˜é‡æ˜¯å¦æ­£ç¡®

### é—®é¢˜ 3ï¼šCORS é”™è¯¯

**åŸå› ï¼š** åç«¯ CORS é…ç½®ä¸æ­£ç¡®

**è§£å†³ï¼š**
1. æ£€æŸ¥åç«¯ `main.ts` ä¸­çš„ CORS é…ç½®
2. ç¡®è®¤ `FRONTEND_URL` ç¯å¢ƒå˜é‡åŒ…å«å‰ç«¯åŸŸå
3. é‡å¯æœåŠ¡

---

## ä¸‹ä¸€æ­¥

æµ‹è¯•é€šè¿‡åï¼Œå¯ä»¥ï¼š

1. **é›†æˆåˆ°å‰ç«¯ä»£ç **
   - åˆ›å»º API å®¢æˆ·ç«¯å°è£…
   - åœ¨éœ€è¦çš„åœ°æ–¹è°ƒç”¨åç«¯ API

2. **æ·»åŠ å‰ç«¯ UI**
   - æ˜¾ç¤ºç§¯åˆ†ä½™é¢
   - æ˜¾ç¤ºç§¯åˆ†æ¶ˆè´¹è®°å½•
   - æ˜¾ç¤ºæ“ä½œæ—¥å¿—

3. **å®Œå–„åŠŸèƒ½**
   - ç”¨æˆ·æ³¨å†Œ
   - å¯†ç é‡ç½®
   - ç§¯åˆ†å……å€¼







