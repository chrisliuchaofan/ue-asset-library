# 提交约束已配置 - 在 Git 端控制

## ✅ 已完成的配置

### 1. 增强了 `scripts/pre-push.sh`

**新增功能：**

1. **提交频率检查**：
   - 如果最近 1 小时内有超过 5 个提交，会警告
   - 提示合并提交后再推送
   - 可以选择继续或取消

2. **文档变更检查**：
   - 如果本次推送只包含文档变更（.md, .txt, docs/, README 等）
   - 会警告并提示可以合并到其他提交
   - 可以选择继续或取消

**工作方式：**
- 当你执行 `git push` 时，如果配置了 `pre-push` hook，会自动运行
- 或者手动运行：`./scripts/pre-push.sh`

---

## 🚀 使用方法

### 正常推送流程：

```bash
# 1. 提交代码
git add .
git commit -m "feat: 添加新功能"

# 2. 推送（会自动检查）
git push
```

**如果触发警告：**
- 会显示警告信息
- 询问是否继续
- 输入 `y` 继续，输入 `n` 取消

---

### 合并多个提交：

如果提示提交太频繁，可以合并：

```bash
# 方法 1：交互式合并（推荐）
git rebase -i origin/main
# 在编辑器中，将后几个 commit 的 "pick" 改为 "squash"
# 保存后，编辑合并后的 commit 消息

# 方法 2：简单合并（如果还没推送）
git reset --soft origin/main
git commit -m "feat: 多个功能更新"
git push
```

---

## 📋 工作流程建议

### 推荐的工作流程：

1. **本地开发，频繁 commit**：
   ```bash
   git commit -m "feat: 功能 A"
   git commit -m "fix: 修复 B"
   git commit -m "docs: 更新文档"
   ```

2. **推送前检查**：
   ```bash
   # 查看未推送的 commit
   git log origin/main..HEAD --oneline
   
   # 如果太多，合并后再推送
   git rebase -i origin/main
   ```

3. **推送**：
   ```bash
   git push
   # 如果触发警告，根据提示决定是否继续
   ```

---

## 🎯 预期效果

**配置前：**
- 每次推送都触发部署
- 昨天 100+ 次部署
- 达到 Vercel 限制

**配置后：**
- 频繁提交时会警告，提醒合并
- 只改文档时会警告，可以取消推送
- **预计每天部署次数减少到 20-40 次**

---

## ⚡ 立即测试

**测试提交频率检查：**

```bash
# 创建多个测试 commit（如果还没有）
git commit --allow-empty -m "test: 提交 1"
git commit --allow-empty -m "test: 提交 2"
git commit --allow-empty -m "test: 提交 3"
git commit --allow-empty -m "test: 提交 4"
git commit --allow-empty -m "test: 提交 5"
git commit --allow-empty -m "test: 提交 6"

# 尝试推送，应该会看到警告
git push
```

**测试文档变更检查：**

```bash
# 只改文档
echo "# 测试" >> README.md
git add README.md
git commit -m "docs: 测试文档变更"
git push
# 应该会看到警告，提示只改文档
```

---

## 📝 注意事项

1. **pre-push hook 需要配置**：
   - 如果 `package.json` 中有 `"pre-push": "./scripts/pre-push.sh"`
   - 使用 `npm run pre-push` 或 `git push` 时会自动运行
   - 或者手动运行：`./scripts/pre-push.sh`

2. **可以跳过检查**：
   - 如果确实需要频繁推送，可以输入 `y` 继续
   - 或者使用 `git push --no-verify` 跳过检查（不推荐）

3. **合并 commit 要谨慎**：
   - 如果已经推送，不要使用 `git reset`
   - 使用 `git rebase -i` 更安全

---

## 🎉 总结

**已配置：**
- ✅ `pre-push.sh` 已增强，添加提交频率和文档变更检查
- ✅ 推送时会自动检查并警告
- ✅ 可以在 Git 端控制，避免频繁部署

**下一步：**
- 等待 1 小时 Vercel 限制重置
- 测试新的提交约束
- 根据提示合并提交，减少部署次数

**这样可以在提交端控制，比在 Vercel 端过滤更合理！**







