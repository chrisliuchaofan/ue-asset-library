# 性能测试指南

## 概述

本指南说明如何测试系统在大量数据下的读取性能和稳定性。

## 快速开始

### 1. 生成测试数据

```bash
# 生成200个资产和100个素材
npx tsx scripts/generate-test-data.ts

# 或者自定义数量
npx tsx scripts/generate-test-data.ts --assets=200 --materials=100
```

### 2. 运行性能测试

```bash
npx tsx scripts/test-read-performance.ts
```

## 测试场景

性能测试脚本会自动测试以下场景：

### 1. 基础API测试
- **获取资产列表**: 测试 `/api/assets` 接口
- **获取素材列表**: 测试 `/api/materials` 接口

### 2. 查询API测试
- **资产查询（筛选）**: 测试带筛选条件的查询
- **素材查询（筛选）**: 测试带筛选条件的查询

### 3. 分页性能测试
- 测试不同 `limit` 值下的性能（10, 20, 50, 100）

### 4. 并发查询测试
- 测试5个并发请求
- 测试10个并发请求

### 5. 页面加载测试
- 测试 `/assets` 页面
- 测试 `/materials` 页面
- 测试首页 `/`

## 性能指标

### 响应时间基准

- **优秀**: < 200ms
- **良好**: 200-500ms
- **一般**: 500-1000ms
- **较差**: > 1000ms

### 内存使用

测试会监控内存使用情况，关注：
- 初始内存使用
- 测试后内存使用
- 内存增长量

## 预期结果

基于系统优化，预期性能：

### 小数据量 (< 100条)
- API响应: < 100ms
- 页面加载: < 500ms

### 中等数据量 (100-500条)
- API响应: < 200ms
- 页面加载: < 1000ms

### 大数据量 (500-1000条)
- API响应: < 500ms
- 页面加载: < 2000ms

## 优化建议

如果测试发现性能问题：

### 1. API查询优化
- 检查索引是否生效
- 优化查询条件
- 使用分页限制结果集

### 2. 缓存优化
- 检查缓存命中率
- 调整缓存TTL
- 考虑增加缓存层

### 3. 数据库优化
- 检查数据库索引
- 优化查询语句
- 考虑数据分片

### 4. 前端优化
- 使用虚拟滚动（已实现）
- 图片懒加载（已实现）
- 代码分割和按需加载

## 故障排查

### 如果测试失败

1. **检查服务器状态**
   ```bash
   # 查看服务器日志
   # 检查是否有错误信息
   ```

2. **检查数据量**
   ```bash
   # 确认测试数据已生成
   # 可以通过管理界面查看数据数量
   ```

3. **检查内存使用**
   - 如果内存持续增长，可能存在内存泄漏
   - 检查是否有未释放的资源

4. **检查网络连接**
   - 确保本地服务器正常运行
   - 检查API端点是否正确

## 持续监控

建议定期运行性能测试：

1. **开发阶段**: 每次重大更新后测试
2. **部署前**: 确保性能达标
3. **生产环境**: 定期监控性能指标

## 自动化测试

可以将测试集成到CI/CD流程：

```bash
# 在CI脚本中
npm run dev &
sleep 10  # 等待服务器启动
npx tsx scripts/generate-test-data.ts --assets=50 --materials=25
npx tsx scripts/test-read-performance.ts
```

## 注意事项

1. **测试环境**: 建议在开发环境先测试
2. **数据清理**: 测试后可以清理测试数据
3. **资源限制**: 注意服务器资源限制
4. **网络环境**: 确保网络连接稳定

## 相关文件

- `scripts/generate-test-data.ts` - 生成测试数据
- `scripts/test-read-performance.ts` - 性能测试脚本
- `STRESS_TEST.md` - 上传压力测试指南











