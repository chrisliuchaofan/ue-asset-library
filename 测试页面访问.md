# 测试页面访问问题

## 问题现象
点击"用户管理"、"兑换码管理"、"积分管理"时，页面会"闪一下，什么都没有"，控制台也没有日志。

## 可能的原因

1. **页面加载后立即被重定向**：`useRequireAdmin` 在页面加载时检查权限，如果失败立即重定向到 `/admin`
2. **路由配置问题**：Next.js 路由可能有问题
3. **环境变量未正确加载**：`NEXT_PUBLIC_ADMIN_USERS` 在客户端未正确加载

## 测试步骤

### 方法 1：直接在地址栏输入 URL

1. 打开浏览器
2. 在地址栏直接输入：
   - `http://localhost:3000/admin/users`
   - `http://localhost:3000/admin/redeem-codes`
   - `http://localhost:3000/admin/credits`
3. 查看：
   - URL 是否变化
   - 页面是否加载
   - 控制台是否有日志

### 方法 2：检查网络请求

1. 打开开发者工具（F12）
2. 切换到 **Network** 标签
3. 点击这三个菜单项
4. 查看是否有网络请求：
   - 是否有对 `/admin/users` 等的请求
   - 请求状态码是什么（200, 302, 404等）
   - 是否有重定向（302）

### 方法 3：检查环境变量

在浏览器控制台运行：

```javascript
// 检查环境变量是否加载
console.log('NEXT_PUBLIC_ADMIN_USERS:', process.env.NEXT_PUBLIC_ADMIN_USERS);
console.log('ADMIN_USERS:', process.env.ADMIN_USERS);
```

**注意**：`process.env.ADMIN_USERS` 在客户端是 `undefined`（这是正常的），只有 `NEXT_PUBLIC_ADMIN_USERS` 才能在客户端访问。

### 方法 4：检查 session

在浏览器控制台运行：

```javascript
// 检查当前 session
fetch('/api/auth/session').then(r => r.json()).then(console.log);
```

查看返回的 `email` 字段，确认当前登录用户的 email。

## 预期结果

如果一切正常：
- URL 应该变为 `/admin/users` 等
- 控制台应该有 `[UsersPage] 页面加载` 等日志
- 页面应该显示内容，而不是"闪一下"

如果权限检查失败：
- 控制台应该有 `[isAdmin] 检查权限` 和 `[useRequireAdmin] 权限检查` 日志
- 然后重定向到 `/admin`

## 如果还是没有日志

可能的原因：
1. **页面根本没有加载**：路由配置有问题
2. **重定向太快**：在组件渲染前就被重定向了
3. **代码没有更新**：需要重启开发服务器







