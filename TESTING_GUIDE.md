# 测试指南

## 🎯 测试目标

本指南帮助你测试系统在大量数据下的性能和稳定性。

## 📋 测试流程

### 步骤1: 生成测试数据

生成200个资产和100个素材（模拟真实场景）：

```bash
# 启动服务器（如果还没启动）
npm run dev

# 在另一个终端运行
npx tsx scripts/generate-test-data.ts
```

**自定义数量：**
```bash
# 生成300个资产和150个素材
npx tsx scripts/generate-test-data.ts --assets=300 --materials=150
```

### 步骤2: 运行性能测试

测试页面加载和API查询性能：

```bash
npx tsx scripts/test-read-performance.ts
```

### 步骤3: 查看结果

测试脚本会输出：
- ✅ 每个API的响应时间
- ✅ 页面加载时间
- ✅ 内存使用情况
- ✅ 性能评级和建议

## 📊 测试指标说明

### API响应时间

- **< 200ms**: ✅ 优秀
- **200-500ms**: ✅ 良好
- **500-1000ms**: ⚠️ 一般，建议优化
- **> 1000ms**: ❌ 较差，需要优化

### 内存使用

- 关注内存增长量
- 如果持续增长，可能存在内存泄漏
- 正常情况下，内存增长应该很小

## 🔍 测试场景

### 1. 基础读取测试
- 获取所有资产列表
- 获取所有素材列表

### 2. 查询性能测试
- 带关键词搜索
- 带类型筛选
- 带标签筛选
- 组合筛选

### 3. 分页性能测试
- 测试不同limit值（10, 20, 50, 100）
- 验证分页是否影响性能

### 4. 并发测试
- 5个并发请求
- 10个并发请求
- 验证系统稳定性

### 5. 页面加载测试
- 资产列表页
- 素材列表页
- 首页

## 🛠️ 故障排查

### 如果测试失败

1. **检查服务器是否运行**
   ```bash
   # 确保开发服务器正在运行
   npm run dev
   ```

2. **检查数据是否生成**
   - 访问管理界面查看数据数量
   - 确认测试数据已成功创建

3. **查看服务器日志**
   - 检查是否有错误信息
   - 查看内存使用情况

4. **检查网络连接**
   - 确保API端点可访问
   - 检查防火墙设置

### 如果性能较差

1. **检查数据量**
   - 确认实际数据量
   - 考虑是否需要优化查询

2. **检查缓存**
   - 查看缓存命中率
   - 考虑增加缓存

3. **检查索引**
   - 确认数据库索引存在
   - 优化查询条件

## 💡 优化建议

### 如果响应时间 > 1000ms

1. **启用缓存**
   - API查询结果缓存（已实现，30秒TTL）
   - 考虑增加缓存时间

2. **优化查询**
   - 使用limit限制结果集
   - 避免加载不必要的数据

3. **前端优化**
   - 使用虚拟滚动（已实现）
   - 图片懒加载（已实现）
   - 分页加载

### 如果内存持续增长

1. **检查内存泄漏**
   - 查看是否有未释放的资源
   - 检查事件监听器是否正确清理

2. **限制并发**
   - 减少同时处理的请求数
   - 使用队列管理请求

## 📝 测试报告示例

```
📋 性能测试结果:
================================================================================
测试项                          耗时(ms)     状态     数据大小    
--------------------------------------------------------------------------------
获取资产列表                     145ms       ✅       125.3KB    
获取素材列表                     89ms        ✅       45.2KB     
资产查询（筛选）                 234ms       ✅       78.5KB     
素材查询（筛选）                 156ms       ✅       32.1KB     
资产查询（limit=10）             67ms        ✅       12.3KB     
资产查询（limit=50）             123ms       ✅       58.7KB     
并发查询 (5个)                   456ms       ✅       -          
页面加载: /assets                1234ms      ✅       245.6KB    
页面加载: /materials             987ms       ✅       189.2KB    

📊 性能分析:
================================================================================
平均响应时间: 389ms
最快响应: 67ms
最慢响应: 1234ms

✅ 性能良好！平均响应时间 < 500ms
```

## 🎯 下一步

测试完成后：

1. **如果性能良好**: 可以放心使用
2. **如果性能一般**: 参考优化建议进行改进
3. **如果性能较差**: 需要重点优化，考虑：
   - 增加缓存
   - 优化数据库查询
   - 使用CDN加速
   - 考虑数据分片

## 📚 相关文档

- `PERFORMANCE_TEST.md` - 详细性能测试指南
- `STRESS_TEST.md` - 上传压力测试指南
- `scripts/README.md` - 脚本使用说明









